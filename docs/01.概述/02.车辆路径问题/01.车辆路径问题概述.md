---
title: 车辆路径问题概述
date: 2022-11-04 13:23:02
permalink: /pages/be2b74/
---

## 引言

在介绍车辆路径问题（Vehicle Routing Problem）之前，我倾向于了解一些基于它的延伸资料，以下内容包括旅行商问题和NP问题的初步认识，由于这些资料不是必须的，读者可以不看这一章节的内容，直接跳到[车辆路径问题](/pages/be2b74/#车辆路径问题)开始阅读。

### 旅行商问题

旅行商问题（Traveling Salesman Prbolem）是运筹学领域一个著名的问题之一，TSP 的定义大致如下：设想有一个推销员，他要去若干个城市推销自己的商品，他可以选择从一个城市出发，依次拜访所有城市后，再回到出发地。请问他应当如何选择自己的行进路线，使得总的经过路径最短？从图论的角度来看，该问题相当于在一个给定的完全无向图中，寻找最短的哈密顿回路。

很明显，TSP 问题的解空间是所有顶点（城市）的全排列，这是由于任意两个城市之间都存在着一条边，因此所有行进路线的总数应当是 $N!$，考虑到 $a \rightarrow b \rightarrow c$ 和 $c \rightarrow b\rightarrow a$ 是两条相同的路径，那么所有可行解的数量为 $\frac{N!}{2}$。因此，TSP 是一个 NP 问题，进一步的，它实际上还是一个 NPC 问题。

早期学者可能使用割平面法（Cutting plane）、分枝定界法（Branch and bound）以及动态规划法（Dynamic programming）来求解 TSP，这固然可以找到问题的精确解，但随着问题规模的扩大，这类算法已不能胜任此项工作，因此，越来越多的研究倾向于使用启发式算法来求解 TSP，包括遗传算法（Genetic Algorithm)、模拟退火算法（Simulated Annealing）、禁忌搜索算法（Tabu Search）、贪婪算法（Greedy）和神经网络算法（Neural Networks）等。

假如一共有 $N$ 个城市，从城市 $i$ 到城市 $j$ 的距离为 $d_{ij}$，由于TSP问题的关键在于确定最短的行进路线，所以我们还需要一个变量用来标识推销员的移动过程，这可以用一个0-1变量 $x_{ij}$来表示，如果他在到达城市 $i$ 后的下一个到达城市是 $j$，那么 $x_{ij} = 0$。

我们用 $V$ 来表示所有城市的集合，这样，TSP 问题可被如下的数学模型所描述：

$$
\begin{align}
\min & \sum_i \sum_j x_{ij} d_{ij} \\
s.t. & \quad \\
& \sum_i x_{ij} = 1 \qquad \forall j \in V \tag{1} \\
& \sum_jx_{ij} = 1 \qquad \forall i \in V \tag{2} \\
& x_{ii} = 0 \qquad \forall i \in V \tag{3} \\
& \sum_i \sum_j x_{ij} \leqslant |S| - 1 \qquad \forall S \subset V, S \neq \varnothing \tag{4} \\
& x_{i,j} \in \{0, 1\}\qquad \forall i,j \in V
\end{align}
$$

其中，式（1）-（3）保证了所有的城市都只会被到访和离开一次，但它无法保证推销员的行进路线是一个哈密顿回路，换言之，会有“子回路”的情况出现，如下图所示。

![](https://cdn.jsdelivr.net/gh/musoulee/figurebed/figures/20221105120224.png)


为了消除可行解中的子回路，式（4）的作用就派上用场了，这是由 Dantzig、Fulkerson 和 Johnson 三位学者共同提出的，因此被称为 DFJ 约束，它通过枚举每一个 $V$ 的子集，确保子集中的边的数量必须小于等于子集顶点数减 1，以达到消除子回路的目的。

DFJ 约束在实际建模中应用并不广泛，根本原因是枚举的时间复杂度太高，达到了指数级 $O (2^N)$，为了解决这个问题，学者另外提出了一种办法，称为 MTZ 约束，能够在 $O (N^2)$ 的代价内消除所有子回路，这里不过多介绍，我将在车辆路径问题建模方法中详细说明。

### P vs. NP
前面我们提到，TSP 是一个 NPC 问题，那么，究竟什么是 NPC 问题？回答这个问题之前，我们先来了解一下什么是 P 问题。

维基百科对 [P问题](https://zh.wikipedia.org/wiki/P_(%E8%A4%87%E9%9B%9C%E5%BA%A6)) 的定义为：在复杂度类问题中可于确定型图灵机于多项式时间内解决的决定性问题。读不懂？没关系，我也读不懂，简单来讲，如果一个问题的时间复杂度可以表示为$O(N^k)$，那么这个问题可以叫做P问题，这里P就是多项式（Polynomial）的意思。例如，求两个数的最大公因数，对一个数组进行排序都属于P问题。

NP问题，英文全称为Non-deterministic Problem，即非确定性多项式问题。NP问题是P问题的超集，它还包含可在多项式时间内验证其解是否正确的决定性问题。例如，我们无法在多项式时间内求解一个数独问题，但却可以在多项式时间内验证一个数独的解是否满足所有约束，因此，数独问题就是一个NP问题。

最后要介绍的是NPC问题，它的全称是NP Complete，即NP完备问题。数学家已经证明，所有的NP问题都可以在多项式时间内被归约为NPC问题，而所有的NPC问题之间也是可以相互归约的。换言之，只要任何一个NPC问题能在多项式时间内被解决，那么所有的NP问题都能在多项式时间内被解决，即千禧七大难题之$P=NP?$问题。


## 车辆路径问题

车辆路径问题是一个组合优化和整数规划的问题，它最早于1959年由George Dantzig和John Ramser发表在他们的论文[《The Truck Dispatching Problem》](https://doi.org/10.1287/mnsc.6.1.80)中。

从论文的题目可以看出，作者考虑的是一个卡车派送的问题，但我们还是以推销员为例，假设这时每个城市的客户都有自己对于产品的需求量$q_i$，而商人所能携带的最大产品数量为$C$，这样他就必须在拜访一定数量的城市之后，再回到原来的城市取货，因此，他也必须每次从固定的城市出发。

经过数十年的发展，目前研究的主流的车辆路径问题已与Dantzig那个时代相差甚远，[MBA智库百科](https://wiki.mbalib.com/wiki/%E8%BD%A6%E8%BE%86%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98)对VRP的定义为：一定数量的客户，各自有不同数量的货物需求，配送中心向客户提供货物，由一个车队负责分送货物，组织适当的行车路线，目标是使得客户的需求得到满足，并能在一定的约束下，达到诸如**路程最短、成本最小、耗费时间最少**等目的。

### 分类
在这个定义里，“一定的约束”是灵活可变的，根据不同的约束，VRP也发展出了不同的分支，包括但不限于以下分类

- 具有容量限制车辆路径问题 **CVRP**(Capacited VRP)，最基础的VRP模型，每辆车具有最大的容量限制。
- 带时间窗车辆路径问题 **VRPTW**(VRP Time Windows)，每个顾客被服务的时间要求在一定时间段（时窗）内，分为硬时间窗和软时间窗。硬时间窗要求车辆必须在指定时窗内到达，软时间窗则无此要求，但对没有按时到达情况必须在目标函数里作出惩罚。
- 同时取送货的车辆路径问题 **VRPB**(VRP with Backhauls)，车辆在送货的同时承担从客户处取货的任务，比如快递员在派件时，也可以从顾客那里取走顾客的寄件。
- 多车型车辆路径问题 **MFVRP**(Mixed Fleet VRP)，车辆具有不同的类型和不同的行驶距离及容量约束。
- 多车场车辆路径问题 **MDVRP**(Multi-Depot VRP)，车辆可以从一个发车点出发，完成配送任务后回到另外一个发车点。
- 随机需求车辆路径问题 **VRPSD**(VRP with Stochastic Demand)

### 算法

我们知道，VRP其实是TSP的特例（假如车辆容量无限大），既然TSP是NP难题，那么VRP也同样是，针对这类问题，目前的算法分为精确式算法和启发式算法，其中精确式算法求解效率高，但可求解的问题规模较小，所以目前学者的研究大部分集中在寻找更快更好的启发式算法上面。以下先对这些算法进行一个罗列，具体内容将在后续进行拓展。

精确式算法有很多，全部学习不太现实，读者（我）需要掌握的算法有
- 分枝定界算法
- 动态规划算法
- 集合分割和列生成算法
- 三下标流和两下标流算法

启发式算法的分类就更多了，这里只列出其中一些经典的算法
- 节约里程算法，也叫Clarke-Wright算法
- Sweep算法
- 禁忌搜索算法
- 遗传算法

其中，禁忌搜索和遗传算法又被称为元启发式算法，这类算法依赖一系列初始的可行解，在迭代过程中不断地进行改善，因此初始解的选择直接决定了算法最后的求解效果，目前学界一般的做法是使用列生成等精确算法来得到初始解。


## 参考资料
- [1]刘云忠, 宣慧玉. 车辆路径问题的模型及算法研究综述[J]. 管理工程学报, 2005(1): 124-130.
- [2]DANTZIG G B, RAMSER J H. The Truck Dispatching Problem[J/OL]. Management Science, 1959, 6(1): 80-91. DOI:[10.1287/mnsc.6.1.80](https://doi.org/10.1287/mnsc.6.1.80).